package exit.services.singletons.entidadesARecuperar;

import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Properties;

import exit.services.fileHandler.ConstantesGenerales;
import exit.services.fileHandler.DirectorioManager;

public class PeticionEntidad implements IPeticiones{
	private static PeticionEntidad instance;
	private Peticion get;
	private Peticion post;
	private Peticion update;
	private Peticion delete;
    private PeticionEntidad(String nombreEntidad){
        Properties props = new Properties();
        try{
    		props.load(new FileReader(ConstantesGenerales.reemplazarArrobas(ConstantesGenerales.PATH_PETICIONES_ENTIDAD_GET, nombreEntidad)));
    		get=new Peticion(props.getProperty("metodo"), Integer.parseInt(props.getProperty("codigoResponseEsperado")), props.getProperty("cabecera"));
    		props.load(new FileReader(ConstantesGenerales.reemplazarArrobas(ConstantesGenerales.PATH_PETICIONES_ENTIDAD_POST, nombreEntidad)));
    		post=new Peticion(props.getProperty("metodo"), Integer.parseInt(props.getProperty("codigoResponseEsperado")), props.getProperty("cabecera"));
    		props.load(new FileReader(ConstantesGenerales.reemplazarArrobas(ConstantesGenerales.PATH_PETICIONES_ENTIDAd_UPDATE, nombreEntidad)));
    		update=new Peticion(props.getProperty("metodo"), Integer.parseInt(props.getProperty("codigoResponseEsperado")), props.getProperty("cabecera"));
    		props.load(new FileReader(ConstantesGenerales.reemplazarArrobas(ConstantesGenerales.PATH_PETICIONES_ENTIDAD_DELETE, nombreEntidad)));
    		delete=new Peticion(props.getProperty("metodo"), Integer.parseInt(props.getProperty("codigoResponseEsperado")), props.getProperty("cabecera"));
        }
        catch(Exception e){
        	e.printStackTrace();
        	try(FileWriter fw= new FileWriter(DirectorioManager.getDirectorioFechaYHoraInicio("error.txt"))){
				fw.write("Error al recuperar las propierdades del fichero: ConfiguracionGeneral.properties");
			} catch (IOException e1) {
				e1.printStackTrace();
			}
        }
    }
    
    void reiniciar(){
    	instance=null;
    }

	public synchronized static IPeticiones getInstance() {
		return RecuperadorPeticiones.getInstance();
    }

	public synchronized static IPeticiones getInstance(String nombre) {
    	if(instance==null)
    		instance=new PeticionEntidad(nombre);
    	return instance;	
    }


	public Peticion getGet() {
		return get;
	}

	public Peticion getPost() {
		return post;
	}

	public Peticion getUpdate() {
		return update;
	}

	public Peticion getDelete() {
		return delete;
	}	
}
